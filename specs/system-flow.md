# 抽奖系统流程图

## 用户抽奖流程

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  用户登录/注册   │───▶│    抽奖页面     │───▶│    点击抽奖     │
│  (JWT认证)      │    │   (转盘界面)    │    │   (触发请求)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                                                        ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   返回结果      │◀───│   更新库存      │◀───│   验证请求      │
│  (展示动画)     │    │  (记录中奖)     │    │ (防刷/库存检查) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                                                        ▼
                                                ┌─────────────────┐
                                                │   抽奖引擎      │
                                                │  (概率计算)     │
                                                └─────────────────┘
```

## 数据层

```
┌─────────────────┐    ┌─────────────────┐
│   MySQL 8.0     │    │     Redis       │
│  用户/奖品/记录  │    │   库存缓存      │
│  主数据库       │    │   会话管理      │
└─────────────────┘    └─────────────────┘
```

## 管理功能

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   管理后台      │    │  全局中奖历史   │    │    压测工具     │
│  (免登录)       │    │ (直接查询数据库)│    │  (Vegeta)       │
│  活动/奖品配置  │    │  (无缓存优化)   │    │ 批量注册+压测   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 核心模块

### 防刷机制
- 频率限制（1分钟1次）
- 活动时间控制
- 总次数限制
- 用户状态检查

### 库存控制
- 严格防超卖
- 数据库事务
- Redis缓存
- 库存预警

### 概率算法
- 权重法/区间法
- 公平性保证
- 可配置概率
- 实时生效

## 部署方案
```
Docker + Docker-compose
前端 + 后端 + MySQL + Redis + Nginx
```

## 压测体系
- Vegeta压测工具
- 批量注册1000万用户
- 数据一致性验证
- QPS/响应时间监控